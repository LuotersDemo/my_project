name: ğŸ”„ Sync from Gitee to GitHub

on:
  # æ–¹å¼1ï¼šå®šæ—¶åŒæ­¥ï¼ˆæ¨èï¼‰
  schedule:
    - cron: '*/5 * * * *'  # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆUTCæ—¶é—´ï¼‰

  # æ–¹å¼2ï¼šæ‰‹åŠ¨è§¦å‘ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›‘ Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.12.1
        with:
          access_token: ${{ github.token }}

      - name: ğŸ“¥ Checkout GitHub (dummy)
        uses: actions/checkout@v4

      - name: ğŸ”‘ Set Git Identity
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: ğŸŒ Clone from Gitee
        env:
          GITEE_USERNAME: ${{ secrets.GITEE_USERNAME }}
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
        run: |
          # æ„å»º Gitee ä»“åº“ URLï¼ˆæ³¨æ„ï¼šä»“åº“åéœ€åŒ¹é…ï¼‰
          GITEE_REPO="https://${GITEE_USERNAME}:${GITEE_TOKEN}@gitee.com/${GITEE_USERNAME}/${{ github.event.repository.name }}.git"
          
          echo "Cloning from Gitee..."
          git clone "$GITEE_REPO" gitee-mirror

      - name: ğŸ”„ Push to GitHub
        working-directory: gitee-mirror
        run: |
          # è·å–å½“å‰åˆ†æ”¯åï¼ˆå‡è®¾ä¸»åˆ†æ”¯ä¸º mainï¼‰
          BRANCH=$(git branch --show-current)
          echo "Current branch: $BRANCH"

          # æ·»åŠ  GitHub è¿œç¨‹ï¼ˆä½¿ç”¨å†…ç½® GITHUB_TOKENï¼‰
          git remote add github-origin "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git"

          # å¼ºåˆ¶æ¨é€åˆ° GitHubï¼ˆè¦†ç›–å†å²ï¼‰
          git push github-origin "$BRANCH" --force

          echo "âœ… Sync completed!"
